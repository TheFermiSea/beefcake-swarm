Bootstrap: docker
From: rust:1.88-bookworm

%post
    apt-get update && apt-get install -y git clang libclang-dev && rm -rf /var/lib/apt/lists/*
    rustup component add clippy rustfmt
    # beads_rust depends on rich_rust which requires nightly (let_chains feature)
    rustup toolchain install nightly
    cargo +nightly install --git https://github.com/Dicklesworthstone/beads_rust
    ln -sf /usr/local/cargo/bin/br /usr/local/cargo/bin/bd
    # Pre-warm cargo registry
    mkdir -p /opt/cargo-cache

%environment
    export PATH="/usr/local/cargo/bin:$PATH"
    export CARGO_HOME="/opt/cargo-cache"
    export RUST_LOG="${RUST_LOG:-info}"

%labels
    Author beefcake-swarm
    Description Sandbox for swarm-agents orchestrator
